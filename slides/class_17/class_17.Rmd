---
title: "Probabilidad e Inferencia Estad칤stica"
subtitle: "#17: Test de Hip칩tesis en una muestra"
author: "<br> Mauricio Bucca <br> [github.com/mebucca](https://github.com/mebucca) <br> mebucca@uc.cl"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["gentle-r.css","xaringan-themer.css"]
    df_print: default
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
      slideNumberFormat: "%current%"
editor_options: 
  chunz_output_type: console
---  
class: inverse, center, middle

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(tidyverse)
library(xaringanthemer)
style_duo_accent(primary_color = "#008C45", secondary_color = "#3949AB",
                 background_color = "#f8f7f3", 
                 header_font_google = google_font("Archivo"),
                 text_font_google   = google_font("Inconsolata"), 
                 link_color= "#FFD100"

)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = T, echo = T)
```

# Test de Hip칩tesis en una muestra



---
## 쯇uede un pulpo predecir los resultados del futbol?


.center[![paul](paul.png)]


---
## 쯇uede un pulpo predecir los resultados del futbol?

| Torneo                  | Partido                 | Predicci칩n | Resultado |
|-------------------------|-------------------------|------------|---------------------|
| Euro 2008               | Alemania vs Polonia     | Alemania   | Correcto            |
| Euro 2008               | Alemania vs Croacia     | Alemania   | Incorrecto          |
| Euro 2008               | Alemania vs Austria     | Alemania   | Correcto            |
| Euro 2008               | Alemania vs Portugal    | Alemania   | Correcto            |
| Euro 2008               | Alemania vs Turqu칤a     | Alemania   | Correcto            |
| Euro 2008               | Alemania vs Espa침a      | Alemania   | Incorrecto          |
| Mundial 2010            | Alemania vs Australia   | Alemania   | Correcto            |
| Mundial 2010            | Alemania vs Serbia      | Serbia     | Correcto            |
| Mundial 2010            | Ghana vs Alemania       | Alemania   | Correcto            |
| Mundial 2010            | Alemania vs Inglaterra  | Alemania   | Correcto            |
| Mundial 2010            | Argentina vs Alemania   | Alemania   | Correcto            |
| Mundial 2010            | Alemania vs Espa침a      | Espa침a     | Correcto            |
| Mundial 2010            | Uruguay vs Alemania     | Alemania   | Correcto            |
| Mundial 2010            | Pa칤ses Bajos vs Espa침a  | Espa침a     | Correcto            |


---
## 쯇uede un pulpo predecir los resultados del futbol?

쯇aul tiene habilidades especiales o tuvo suerte?

--

Esta es una pregunta emp칤rica y la podemos testear.

--

.pull-left[
![](https://static.onecms.io/wp-content/uploads/sites/21/2010/10/pulpo_paul_071410_300.jpg)
]

<br>

.bold[Paso #1: Expresar pregunta en t칠rminos de Hip칩tesis Nula e Hip칩tesis Alternativa]

<br>
--

.bold[Hip칩tesis Nula]: "Paul no tiene ning칰n talento especial, sus predicciones son como tirar una moneda al aire".

- $H_0: \mathbb{P}(\text{Acierto}) = \mathbb{P}(\text{Fallo}) = 0.5$

<br>
--

.bold[Hip칩tesis Alternativa]: "Paul tiene un talento, acierta m치s de lo que falla", o quiz치s 
"Paul es un mal adivino, falla m치s de lo que acierta".

- $H_a: \mathbb{P}(\text{Acierto}) \neq \mathbb{P}(\text{Fallo})$

---
## 쯇uede un pulpo predecir los resultados del futbol?

--

.bold[Paso #2: Elegir y calcular un estad칤stico] 

<br>
--

- Los datos nos muestran que Paul acert칩 en 12 de 14 partidos.

--

- Estad칤stico relevante: proporci칩n de aciertos, $\hat{p}$.

<br>

$$\text{Proporci칩n de Aciertos}: \hat{p} = \frac{12}{14} = 0.857$$

---
## 쯇uede un pulpo predecir los resultados del futbol?

.bold[Paso #3: Determinar la Distribuci칩n Nula]

--

- Es decir, la distribuci칩n muestral de nuestro estad칤stico bajo el supuesto de que la $H_0$ es verdadera -- Paul no tiene habilidad especial y por tanto $\mathbb{P}(\text{Acierto}) = \mathbb{P}(\text{Fallo}) = 0.5$.

--

  - Por el TLC sabemos que:  $\hat{p} \sim \text{Normal}\bigg(p, \frac{\sqrt{p(1-p)} }{\sqrt{n}}\bigg)$
 
--

  - Por tanto,  $\hat{p} \mid H_{0} \sim \text{Normal}\bigg(0.5, \frac{\sqrt{0.5(1-0.5)} }{\sqrt{n}}\bigg)$

<br>
--

- Estandarizando podemos  derivar un .bold[test-z]:

  - Si $Z_{\hat{p}} = \frac{\hat{p} - p}{\frac{\sqrt{p(1-p)} }{\sqrt{n}}}$ entonces: $Z_{\hat{p}} \mid H_0   \sim \text{Normal}\big(0, 1\big)$

--

  - Nuestro estad칤stico $\hat{p}$ se transforma el .bold[test-z], el valor estandarizado de del estad칤stico bajo $H_0$:

$$\hat{z} = \frac{\hat{p} - p}{\frac{\sqrt{p(1-p)} }{\sqrt{n}}} = \frac{0.857 - 0.5}{\frac{\sqrt{0.5(1-0.5)} }{\sqrt{14}}} = 2.6726$$

---
## 쯇uede un pulpo predecir los resultados del futbol?


.bold[Paso #4: Elegir un nivel de significaci칩n] $\alpha$ 

<br>

Selecciona un .bold[nivel de significaci칩n] $\alpha$, tal que consideraremos como "demasiado alto"/"demasiado bajo" aquellos valores que corresponden al $\alpha$% de valores m치s extremos en la distribuci칩n nula.


<br>

$$\alpha = \mathbb{P}(\text{Rechazar } H_{0} \mid H_{0} \text{ es verdadera})$$

<br>
--


- Mientras menor es $\alpha$ m치s dificl es rechazar la hip칩tesis nula.


- Dado que no confiamos en pulpos adivinos, vamos trabajar a un nivel alto de significaci칩n, $\alpha=0.01$.


---
## 쯇uede un pulpo predecir los resultados del futbol?


.bold[Paso #5: Calcular el valor-p] 

Si la hip칩tesis nula fuera verdadera, 쯘s nuestro estad칤stico un valor esperable o un valor extremo?

--

En nuestro caso estamos testeando

.pull-left[

$\text{valor-p} = \mathbb{P}( \bar{X} > |\hat{p}| \mid H_{0} \text{ es verdadera})$

equivalentemente:

$\text{valor-p} = \mathbb{P}( Z > \big| \frac{\hat{\mu} - \mu}{\sigma/\sqrt{n}} \big| )$


```{r, echo=TRUE, message=FALSE, warning=FALSE}

n <- 14
p_hat <- 12/14

z_hat <- (p_hat - 0.5)/(sqrt(0.5*0.5) /sqrt(n))

pvalue =  2*(1 - pnorm(z_hat))

cat("z_hat=",round(z_hat,2), " valor-p=", pvalue, sep="")
```
]


.pull-right[
```{r, echo=FALSE, fig.height=4.5, fig.width=5,  message=FALSE, warning=FALSE}

# Load necessary libraries
library(ggplot2)
library(dplyr)

primary_color <- "#008C45"
secondary_color <- "#3949AB"
link_color <- "#FFD100"

# Set the mean and standard deviation
mu <- 0
sigma <- 1

# Significance level (풤)
alpha <- 0.01

# Create the normal distribution data
x_values <- seq(-4, 4, by = 0.1)
y_values <- dnorm(x_values, mean = mu, sd = sigma)
normal_data <- data.frame(x = x_values, y = y_values)

# Calculate the cutoff points for the tails
cutoff_left <- qnorm(alpha / 2, mean = mu, sd = sigma)
cutoff_right <- qnorm(1 - alpha / 2, mean = mu, sd = sigma)

# Calculate the p-value corresponding to z-hat
pvalue <- 2 * (1 - pnorm(abs(z_hat), mean = mu, sd = sigma))

# Create the ggplot
normal_distribution_plot <- ggplot(normal_data, aes(x = x, y = y)) +
  geom_line(size = 1, color = primary_color) +

  # Add a vertical line for z-hat with the new color
  geom_vline(xintercept = c(-z_hat,z_hat), color = primary_color, size = 1) +
  
  # Add text label for z-hat
  annotate("text", x = z_hat + 0.9, y = max(normal_data$y) * 0.9, 
           label = paste("z-hat ="), 
           color = primary_color, size = 5) +
  
    annotate("text", x = z_hat + 0.8, y = max(normal_data$y) * 0.85, 
           label = paste(round(z_hat, 2)), 
           color = primary_color, size = 5) +
  
  # Add ribbon for the p-value corresponding to z-hat
  geom_ribbon(data = normal_data %>% filter(x >= z_hat),
              aes(x = x, ymin = 0, ymax = y),
              fill = primary_color, alpha = 0.5) +
  
    # Add ribbon for the p-value corresponding to z-hat
  geom_ribbon(data = normal_data %>% filter(x <= -z_hat),
              aes(x = x, ymin = 0, ymax = y),
              fill = primary_color, alpha = 0.5)  +
  
  # Add labels and theme
  labs(x = "Z", y = "Density") +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 20),
    axis.text.y = element_text(size = 22),
    axis.text.x = element_text(size = 22),
    axis.title.y = element_text(size = 24),
    axis.title.x = element_text(size = 24),
    panel.border = element_rect(fill = NA, linewidth = 1)
  )

# Display the plot
print(normal_distribution_plot)


```
]

---
## 쯇uede un pulpo predecir los resultados del futbol?

--

.bold[Paso #6: Mantener o Rechazar la Hip칩tesis Nula]

--

- Comparamos -- bajo el supuesto de que $H_0$ es verdaadera --  la probabilidad de obtener el resultados que obtuvimos ( valor-p ) vs. el criterio seleccionado para clasificar resultados como "extremos" ( $\alpha$ ).

--

.bold[Decisi칩n:]

 - Si $\text{valor-p} < \alpha$ entonces rechazamos $H_{0}$

 - Si $\text{valor-p} > \alpha$ no podemos rechazar $H_{0}$


<br>
--

En este caso:

```{r, echo=F, message=FALSE, warning=FALSE}

cat("洧띺=",0.01, "; valor-p=",pvalue, sep="")
```

.bold[Conclusi칩n:]

Una tasa de acierto de 85.7% se encuentra por encima de la proporci칩n esperada bajo el supuesto de que la hip칩tesis nula -- que Paul acierta con una probabilidad de 0.5. Por tanto con un nivel de significaci칩n del 1% (o 99% de confianza) podemos rechazar la hip칩tesis nula.

--

Sigue en pie la posibilidad de que Paul tenga habilidades especiales!

---
class: inverse, center, middle

.center[ 
![paul](https://www.toonpool.com/user/10161/files/paul_rules__915595.jpg)
]


---
class: inverse, center, middle


##Hasta la pr칩xima clase. Gracias!

<br>
Mauricio Bucca <br>
https://mebucca.github.io/ <br>
github.com/mebucca




